<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Is It Snowing In Athens?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --yes-bg: #2b6da8;
      --no-bg: #ffffff;
      --yes-text: #ffffff;
      --no-text: #000000;
      --font-main: -apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: var(--font-main);
    }
    body.yes {
      background: radial-gradient(circle at top, #5fa9ff, var(--yes-bg));
      color: var(--yes-text);
    }
    body.no {
      background: var(--no-bg);
      color: var(--no-text);
    }
    .wrapper {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem 1rem;
      box-sizing: border-box;
    }
    #answer {
      font-size: clamp(5rem, 18vw, 12rem);
      font-weight: 700;
      letter-spacing: 0.08em;
      margin: 0 0 1rem;
    }
    #details {
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
    }
    #updated {
      font-size: 0.85rem;
      opacity: 0.7;
      margin-bottom: 2rem;
    }
    #footer {
      font-size: 0.85rem;
      opacity: 0.8;
    }
    #last-snow.yes {
      display: none;
    }    
    a {
      color: inherit;
    }
  </style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BJTH0X52V9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BJTH0X52V9');
</script>

</head>
<body class="no">
  <div class="wrapper">
    <div id="answer">...</div>
    <div id="details">Checking the weather in Athens, GA...</div>
<div id="last-snow" style="font-size: 0.9rem; margin-top: 1rem; opacity: 0.9;">
  Most recent snowfall observed on <span id="last-snow-date">Checking records...</span>
</div>
<br>
<div id="footer">
<a href="https://chrisyetter.github.io/isitsnowinginathens.github.io/about.html"
   style="color: #ccc;">
  About this website
</a>

    </div>
  </div>

  <script>
    const SNOW_CODES = new Set([71, 73, 75, 77, 85, 86]);

    // Snow animation globals
    let canvas, ctx, flakes = [], animationId;
    const MAX_FLAKES = 100;
    const FLAKE_COLORS = ['#ffffff', '#f8f8ff', '#e6e6fa'];

    async function fetchWeather() {
      const url = "https://api.open-meteo.com/v1/forecast"
        + "?latitude=33.95&longitude=-83.38"
        + "&current=temperature_2m,weather_code,precipitation";

      try {
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        const current = data.current;
        const tempF = cToF(current.temperature_2m);
        const code = current.weather_code;
        const precip = current.precipitation;

        const snowing = SNOW_CODES.has(code);

        updatePage(snowing, tempF, code);
      } catch (err) {
        document.getElementById("answer").textContent = "NO";
        document.getElementById("details").textContent =
          "Error checking the weather. Odds are it is not snowing in Athens, GA.";
        document.body.classList.remove("yes");
        document.body.classList.add("no");
        document.getElementById("updated").textContent = "";
        console.error(err);
        stopSnow();
      }
    }

    function cToF(c) {
      return Math.round((c * 9) / 5 + 32);
    }

    function describeWeatherCode(code) {
      // Minimal mapping just for display
      const map = {
        0: "Clear sky",
        1: "Mainly clear",
        2: "Partly cloudy",
        3: "Overcast",
        45: "Foggy",
        48: "Depositing rime fog",
        51: "Light drizzle",
        53: "Drizzle",
        55: "Heavy drizzle",
        61: "Light rain",
        63: "Rain",
        65: "Heavy rain",
        71: "Light snow",
        73: "Snow",
        75: "Heavy snow",
        77: "Snow grains",
        80: "Rain showers",
        81: "Rain showers",
        82: "Violent rain showers",
        85: "Snow showers",
        86: "Heavy snow showers"
      };
      return map[code] || "Current conditions";
    }

function updatePage(snowing, tempF, code) {
  const answerEl = document.getElementById("answer");
  const detailsEl = document.getElementById("details");
  const updatedEl = document.getElementById("updated");

  if (snowing) {
    document.body.classList.remove("no");
    document.body.classList.add("yes");
    answerEl.textContent = "YES!";
    document.title = "❄️ Yes! It is snowing in Athens";
    startSnow();
  } else {
    document.body.classList.remove("yes");
    document.body.classList.add("no");
    answerEl.textContent = "NO";
    document.title = "❌ No. It is not snowing in Athens";
    stopSnow();
  }

      const desc = describeWeatherCode(code);
      detailsEl.textContent =
        desc + " in Athens, GA, with a temperature of " + tempF + "°F.";

      const now = new Date();
     
    }

    // Snow animation functions
    function initSnow() {
      canvas = document.createElement('canvas');
      canvas.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;';
      document.body.appendChild(canvas);
      ctx = canvas.getContext('2d');
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    function createFlake() {
      return {
        x: Math.random() * canvas.width,
        y: Math.random() * -canvas.height,
        size: Math.random() * 4 + 2,
        speed: Math.random() * 2 + 0.5,
        sway: (Math.random() - 0.5) * 0.1,
        color: FLAKE_COLORS[Math.floor(Math.random() * FLAKE_COLORS.length)],
        twinkle: Math.random() * Math.PI * 2
      };
    }

    function animateSnow() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (flakes.length < MAX_FLAKES) flakes.push(createFlake());

      flakes.forEach((flake, i) => {
        ctx.save();
        ctx.globalAlpha = 0.8 + Math.sin(flake.twinkle) * 0.2;
        ctx.fillStyle = flake.color;
        ctx.beginPath();
        ctx.arc(flake.x, flake.y, flake.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();

        flake.y += flake.speed;
        flake.x += Math.sin(flake.y * flake.sway) * 2;
        flake.twinkle += 0.1;

        if (flake.y > canvas.height + flake.size) {
          flakes.splice(i, 1);
        }
      });
      animationId = requestAnimationFrame(animateSnow);
    }

    function startSnow() {
      if (!canvas) initSnow();
      if (animationId) cancelAnimationFrame(animationId);
      flakes = [];
      animateSnow();
    }

    function stopSnow() {
      if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }
      if (ctx) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        flakes = [];
      }
    }

    // Initial fetch
    fetchWeather();

    // Refresh every 5 minutes (300000 ms)
    setInterval(fetchWeather, 5 * 60 * 1000);

async function fetchHistoricalSnow() {
  const displayEl = document.getElementById("last-snow-date");
  
  // 1. Get current date in YYYY-MM-DD format
  const today = new Date().toISOString().split('T')[0];
  
  const url = `https://historical-forecast-api.open-meteo.com/v1/forecast`
    + `?latitude=33.95&longitude=-83.38`
    + `&start_date=2026-01-01&end_date=${today}`
    + `&hourly=snowfall&timezone=America%2FNew_York`;

  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error("Historical API Error");
    const data = await res.json();

    const times = data.hourly.time;
    const snowfall = data.hourly.snowfall;
    let foundDate = null;

    // 2. Loop backwards from the end of the array to find the most recent snow
    for (let i = snowfall.length - 1; i >= 0; i--) {
      if (snowfall[i] > 0) {
        foundDate = new Date(times[i]);
        break;
      }
    }

    if (foundDate) {
      // Format as "January 15, 2024"
      displayEl.textContent = foundDate.toLocaleDateString(undefined, {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    } else {
      displayEl.textContent = "None recorded since Jan 2022";
    }
  } catch (err) {
    console.error("Historical fetch failed:", err);
    displayEl.textContent = "Unavailable";
  }
}

// Call this once on page load
fetchHistoricalSnow();    
</script>

</body>
</html>
